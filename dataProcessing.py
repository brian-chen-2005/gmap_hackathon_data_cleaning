import pandas as pd

import warnings
warnings.filterwarnings('ignore')

pd.set_option('display.max_rows', 651905)
pd.set_option('display.max_columns', 6)

df = pd.read_csv('/Users/brian/traff2/Traffic Camera location data - UW.csv')

#df.info()


print(df['Statute Name'].value_counts().to_frame('counts'))

wrong_locations = [ #locations with 2 or fewer entries: basically just errors when locations were entered
    "SB 23RD AVE E @ E JOHN ST, SEATTLE, WA",
    "600 BLK ELLIOT AVE W",
    "SB 3RD AVE @ STEWART ST, SEATTLE, WA",
    "DENNY WAY WB @ FAIRVIEW AVE, SEATTLE, WA",
    "SW ANDOVER ST / 22 AV SW",
    "RAINIER AV S/S FOREST ST",
    "3 AVE & MARION ST",
    "E OLIVE WY/BELLEVUE AV",
    "WB S MCCLELLAN ST @ MARTIN LUTHER KING JR WAY S, SEATTLE, WA",
    "NB MARTIN LUTHER KING JR WAY S @ S OTHELLO ST, SEATTLE, WA",
    "DELRIDGE WY/SW THISTLE ST",
    "Seattle",
    "SW ADMIRAL WY",
    "NB 3RD AVE @ JAMES ST, SEATTLE, WA",
    "SB 15TH AVE S @ MERCER MIDDLE SCHOOL",
    "SB AURORA AVE",
    "S JACKSON ST/3 AVE S",
    "E THOMAS ST",
    "N 85 ST/AURORA AV N",
    "RAINIER AVE S",
    "600 BLK ELLIOT AV W",
    "NB GREENWOOD AVE N @ BROADVIEW-THOMSON ELEMENTARY",
    "4 AVE S/S MICHIGAN ST",
    "RAINIER AVE S/ S ROSE ST",
    "3RD AVE AND UNIVERSITY ST",
    "SW BARTON ST/31 AV SW",
    "RAINIER AVE S/HENESSEE",
    "MANOR AV / HOWELL ST",
    "sea",
    "SEATTLE",
    "4 AVE S/ S MICHIGAN ST",
    "14 AVE S",
    "15 AV W/GILMAN DR W - SEATTLE",
    "TEST",
    "S/B MOUNTLAKE BLD NE - SEATTLE",
    "S SPOKANE ST/6TH AVE S",
    "SEA",
    "W MARGINAL WY S",
    "NE 45 ST/ROOSEVELT WY NE",
    "MAGNOLIA BLVD/ELLIOT AV",
    "AURORA AVE N & NO 115TH ST",
    "NB Broadway @ E Olive Way, Seattle, WA"
]

df1 = df[~df['Violation Location'].isin(wrong_locations)]

location_to_coord_dict = { #locations are inconsistently recorded so coordinates are inferred one by one based on context
    #(e.g. 'NB 35TH AVE SW @ OUR LADY OF G' is probably the intersection on 35th and myrtle at the 'Our Lady of Guadalupe Catholic Church')
    'EB SW SPOKANE ST @ PORT OF SEA': (47.571422, -122.349760),
    'WB SW SPOKANE ST @ 11TH AVE SW': (47.571410, -122.347968),
    'SB AURORA AVE N @ GALER ST': (47.632272, -122.343495),
    'SB 6TH AVE @ JAMES ST': (47.604156, -122.328125),
    'EB OLIVE WAY @ 5TH AVE (BL)': (47.612692, -122.337434),
    'NB 3RD AVE @ JAMES ST': (47.602773, -122.331442),
    'NB BOREN AVE S @ BAILEY GATZER': (47.600850, -122.316977),
    'SB 3RD AVE @ STEWART ST': (47.611626, -122.339620),
    'SB GREENWOOD AVE N @ BROADVIEW': (47.705065, -122.355491),
    'NB 24TH AVE E @ MONTLAKE ELEME': (47.640259, -122.302094),
    'SB 24TH AVE E @ MONTLAKE ELEME': (47.640259, -122.302094),
    'NB 9TH AVE @ JAMES ST': (47.605567, -122.324742),
    'SB 15TH AVE S @ MERCER MIDDLE': (47.538958, -122.296510),
    'SB 5TH AVE NE @ OLYMPIC VIEW E': (47.697724, -122.323120),
    'EB NE 45TH ST @ ROOSEVELT WAY': (47.661294, -122.317618),
    'NB RAINIER AVE S @ S ORCAS ST': (47.551187, -122.277715),
    'SB RAINER AVE S @ S ORCAS ST': (47.551187, -122.277715),
    'NB GREENWOOD AVE N @ BROADVIEW': (47.714936, -122.355552),
    'WB SW AVALON WAY @ 35TH AVE SW': (47.564090, -122.376203),
    'SB 15TH AVE NW @ NW 80TH': (47.686890, -122.376831),
    'NB 11TH AVE NE @ NE 45TH ST': (47.661301, -122.316613),
    'NB BROADWAY @ E OLIVE WAY': (47.619910, -122.320907),
    'SB BOREN AVE @ JAMES ST': (47.606469, -122.322563),
    'WB NW MARKET ST @ 15TH AVE NW': (47.668686, -122.376236),
    'NB MARTIN LUTHER KING JR WAY S': (47.537074, -122.280960),
    'DENNY WAY EB @ FAIRVIEW AVE': (47.618525, -122.334313),
    'SB BOREN AVE S @ BAILEY GATZER': (47.600859, -122.316978),
    'SB MARTIN LUTHER KING JR WAY S': (47.537074, -122.280960),
    'SB 35TH AVE SW @ SW THISTLE ST': (47.528287, -122.376634),
    'SB 23RD AVE E @ E JOHN ST': (47.620208, -122.302507),
    'EB SW ROXBURY ST @ HOLY FAMILY': (47.517356, -122.359216),
    'EB SPRING ST @ 5TH AVE': (47.607274, -122.332482),
    'NB 35TH AVE SW @ OUR LADY OF G': (47.539232, -122.376561),
    'WB E YESLER WAY @ BAILEY GATZE': (47.601695, -122.314165),
    'NB AURORA AVE N @ N 85TH ST': (47.690566, -122.344532),
    'WB NW 80TH ST @ WHITTIER ELEME': (47.686870, -122.376805),
    'NB DELRIDGE WAY @ STEM AT BORE': (47.549001, -122.363038),
    'WB S COLUMBIAN WAY @ MERCER MI': (47.563683, -122.313428),
    'SB 35TH AVE SW @ OUR LADY OF G': (47.538861, -122.376545),
    'SB FAUNTLEROY AVE SW @ GATEWOO': (47.539907, -122.390598),
    'DENNY WAY WB @ FAIRVIEW AVE': (47.618550, -122.334351),
    'EB NW MARKET ST @ 15TH AVE NW': (47.668684, -122.376215),
    'WB NE 75TH ST @ ECKSTEIN MIDDL': (47.683046, -122.295880),
    'NB 8708 RAINIER AVE S @ SOUTH': (47.523305, -122.269997),
    'NB BOREN AVE @ PIKE ST': (47.613453, -122.328929),
    'NB FAUNTLEROY AVE SW @ GATEWOO': (47.540554, -122.390322),
    'NB 5TH AVE NE @ OLYMPIC VIEW E': (47.697712, -122.323120),
    'WEST SEATLLE BRIDGE EAST OF HWY 99 EXIT': (47.571169, -122.356939),
    'EB COLUMBIA ST @ 1ST AVE': (47.603278, -122.334933),
    'EB NW 80TH ST @ WHITTIER ELEME': (47.686876, -122.376825),
    'NB 172 23RD AVE @ GARFIELD HIG': (47.606174, -122.302801),
    'EB S CLOVERDALE ST @ 14TH AVE': (47.526438, -122.314905),
    'SB DELRIDGE WAY @ STEM AT BORE': (47.548313, -122.363056),
    'WB S MCCLELLAN ST @ MARTIN LUT': (47.578352, -122.296209),
    'SB 1ST AVE @ NORTHGATE ELEMENT': (47.714085, -122.328779),
    'NB MLK JR WAY S @ MCCLELLAN ST': (47.578353, -122.296219),
    'SB GREENWOOD AVE N @ BROADVIEW-THOMSON ELEMENTARY SCHOOL': (47.724689, -122.355578),
    'NB FAUNTLEROY WAY SW @ FAIRMOU': (47.552032, -122.381654),
    'SB FAUNTLEROY WAY SW @ FAIRMOU': (47.552032, -122.381654),
    'NB 6TH AVE @ UNIVERSITY ST': (47.609152, -122.332667),
    'WB S OTHELLO ST @ MARTIN LUTHE': (47.537051, -122.281253),
    'NB BOREN AVE S @ BAILEY GATZERT ELEMENTARY SCHOOL': (47.600860, -122.316986),
    'SB STONE WAY N @ N 40TH ST': (47.655395, -122.342441),
    'WEST SEATLLE BRIDGE EAST OF HW': (47.571555, -122.329908),
    'EB S ORCAS ST @ DEARBORN PARK': (47.550923, -122.297708),
    'NB 8708 RAINIER AVE S @ SOUTH SHORE K-8 SCHOOL': (47.523326, -122.270015),
    'NB RAINIER AVE S @ S MASSACHUS': (47.588439, -122.305848),
    'EB NE 75TH ST @ ECKSTEIN MIDDL': (47.683059, -122.294795),
    'WB S ORCAS ST @ DEARBORN PARK': (47.550901, -122.296778),
    'SB 8825 RAINIER AVE S @ SOUTH': (47.523319, -122.270010),
    'SB MLK JR WAY S @ MCCLELLAN ST': (47.578349, -122.296204),
    'NB BEACON AVE S @ RAINIER VIEW': (47.498728, -122.264429),
    'EB NE 80TH ST @ 5TH AVE NE': (47.686794, -122.322965),
    'NB GREENWOOD AVE N @ BROADVIEW-THOMSON ELEMENTARY SCHOOL': (47.724686, -122.355583),
    'EB NE 45TH ST @ ROOSEVELT WAY NE': (47.661301, -122.317607),
    'SB BOREN AVE S @ BAILEY GATZERT ELEMENTARY SCHOOL': (47.600856, -122.316960),
    'EB SW ROXBURY ST @ HOLY FAMILY ELEMENTARY SCHOOL': (47.517365, -122.359204),
    'SB BEACON AVE S @ RAINIER VIEW': (47.498735, -122.264430),
    'SB 5TH AVE NE @ OLYMPIC VIEW ELEMENTARY SCHOOL': (47.697718, -122.323104),
    'NB 172 23RD AVE @ GARFIELD HIGH SCHOOL': (47.605151, -122.302657),
    'SB 1ST AVE @ JAMES BALDWIN ELEMENTARY SCHOOL': (47.714657, -122.328786),
    'EB NW 80TH ST @ WHITTIER ELEMENTARY SCHOOL': (47.686900, -122.372785),
    'SB FAUNTLEROY AVE SW @ GATEWOOD ELEMENTARY SCHOOL': (47.540559, -122.390307),
    'WB PIKE ST @ BOREN AVE': (47.613461, -122.328904),
    'NB DELRIDGE WAY @ STEM AT BOREN': (47.548315, -122.363037),
    'WB NW 80TH ST @ WHITTIER ELEMENTARY SCHOOL': (47.686900, -122.372785),
    'NB 35TH AVE SW @ OUR LADY OF GUADALUPE SCHOOL': (47.538861, -122.376545),
    'SB 35TH AVE SW @ OUR LADY OF GUADALUPE SCHOOL': (47.538861, -122.376545),
    'NB 5TH AVE NE @ OLYMPIC VIEW ELEMENTARY SCHOOL': (47.697730, -122.323112),
    'WB NE 75TH ST @ ECKSTEIN MIDDLE SCHOOL': (47.683054, -122.295883),
    'WB S MCCLELLAN ST @ MARTIN LUTHER KING JR WAY S': (47.578353, -122.296213),
    'SB MARTIN LUTHER KING JR WAY S @ THURGOOD MARSHALL ELEMENTARY': (47.590260, -122.297501),
    'NB MARTIN LUTHER KING JR WAY S @ S OTHELLO ST': (47.537094, -122.281296),
    'SB 8825 RAINIER AVE S @ SOUTH SHORE K-8 SCHOOL': (47.523334, -122.270011),
    'NB FAUNTLEROY AVE SW @ GATEWOOD ELEMENTARY SCHOOL': (47.539796, -122.390648),
    'WB S OTHELLO ST @ MARTIN LUTHER KING JR WAY S': (47.537099, -122.281290),
    'EB OLIVE WAY @ 5TH AVE (BB)': (47.612696, -122.337425),
    'SB 1ST AVE @ JAMES BALDWIN ELE': (47.714089, -122.328777),
    'SB FAUNTLEROY WAY SW @ FAIRMOUNT PARK ELEMENTARY SCHOOL': (47.552039, -122.381667),
    'EB E OLIVE WAY (WEST) @ BROADWAY': (47.619915, -122.320906),
    'NB FAUNTLEROY WAY SW @ FAIRMOUNT PARK ELEMENTARY SCHOOL': (47.552039, -122.381667),
    'STEWART ST @ DENNY WAY': (47.618501, -122.330715),
    'SB DELRIDGE WAY @ STEM AT BOREN': (47.548312, -122.363040),
    'NB MARTIN LUTHER KING JR WAY S @ THURGOOD MARSHALL ELEMENTARY': (47.590260, -122.297501),
    'EB S CLOVERDALE ST @ 14TH AVE S': (47.526449, -122.314907),
    'WB E YESLER WAY @ BAILEY GATZERT ELEMENTARY SCHOOL': (47.601690, -122.314153),
    'EB NE 75TH ST @ ECKSTEIN MIDDLE SCHOOL': (47.683048, -122.294704),
    'NB BEACON AVE S @ RAINIER VIEW ELEMENTARY SCHOOL': (47.498735, -122.264430),
    'EB BATTERY ST @ 4TH AVE': (47.616153, -122.345224),
    'WB S ORCAS ST @ DEARBORN PARK ELEMENTARY SCHOOL': (47.550916, -122.297705),
    'SB WESTLAKE AVE @ SB VALLEY ST (E SIDE)': (47.625737, -122.338620),
    'SB BEACON AVE S @ RAINIER VIEW ELEMENTARY SCHOOL': (47.498735, -122.264430),
    'NB RAINIER AVE S @ S MASSACHUSETTS ST': (47.588434, -122.305857),
    'SB WESTLAKE AVE @ SB VALLEY ST': (47.625737, -122.338620),
    'EB 5TH AVE @ OLIVE WAY (BL)': (47.612700, -122.337429),
    'EB S ORCAS ST @ DEARBORN PARK ELEMENTARY SCHOOL': (47.550894, -122.296778),
    'NB 4TH AVE @ JACKSON ST (W SID': (47.599212, -122.329037),
    'HOWELL ST @ BOREN AVE': (47.616181, -122.331421),
    'NB 4TH AVE @ JACKSON ST (E SID': (47.599212, -122.329037),
    'YALE AVE @ STEWART ST': (47.618282, -122.331005),
    'NB 4TH AVE @ JACKSON ST (W SIDE)': (47.599212, -122.329037),
    'NB 4TH AVE @ JACKSON ST (E SIDE)': (47.599212, -122.329037),
    'WB SW ROXBURY ST @ HOLY FAMILY': (47.517356, -122.359216)
}


#add coordinate columns
df1['latitude'] = df1['Violation Location'].map(lambda x: location_to_coord_dict.get(x, (None, None))[0])
df1['longitude'] = df1['Violation Location'].map(lambda x: location_to_coord_dict.get(x, (None, None))[1])


#drop entries of wrong locations (no coordinates)
df2 = df1.dropna(subset=['latitude'])

#print(df2['Violation Location'].value_counts().to_frame('counts'))

#values not needed for gmap representation
df3 = df2.drop(['Citation Number', 'StatuteType', 'Statute Number', 'Violation Location'], axis=1)


#grouping data
#*****IMPORTANT*****
#compresses file from 43mb to 4mb
#smaller file size needed when using papaparse later on
compressed_df3 = df3.groupby(['Statute Name', 'Violation Date', 'latitude', 'longitude']).size().reset_index(name='counts')

compressed_df3.info()

compressed_df3.to_csv('cleanedData.csv', index=False)